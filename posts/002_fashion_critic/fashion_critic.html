<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mallika Kulkarni">
<meta name="dcterms.date" content="2025-09-08">
<meta name="description" content="How well does GPT know fashion? Will it be kind to my social media posts and cruel when I ask it to?">

<title>ChatGPT as a Fashion Critic â€“ Letâ€™s Experiment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a1673d5ee3f94a18a47cce2766f25c64.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Letâ€™s Experiment</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">ChatGPT as a Fashion Critic</h1>
                  <div>
        <div class="description">
          How well does GPT know fashion? Will it be kind to my social media posts and cruel when I ask it to?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Pop Culture</div>
                <div class="quarto-category">Trends</div>
                <div class="quarto-category">Personas</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Mallika Kulkarni </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 8, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>What happens when you hand your digital wardrobe over to an LLM and ask it to <strong>form an opinion on your fashion sense</strong>?</p>
<p>For this experiment, I fed ChatGPT some pictures of outfits, a couple that Iâ€™ve posted on <strong>my Instagram</strong>.</p>
<p><img src="profile.png" class="img-fluid"></p>
<p>The motivation behind this is to ascertain what will happen as LLMs insert themselves into social media as commenting bots or ad generators. I specifically sacrificed my Instagram, rather than stock photos, to get the data and results that I am most interested in.</p>
<p>Then I asked it to review them in with <strong>three distinct personas</strong>:</p>
<ul>
<li>A Vogue fashion editor</li>
<li>A TikTok fashion influencer</li>
<li>A friend who supports you through any decision</li>
</ul>
<p>Letâ€™s see how well GPT understands fashion contextually. Can an LLM analyze not just colors and fabrics, but also trends, fit, and aesthetics?</p>
</section>
<section id="the-inputs" class="level2">
<h2 class="anchored" data-anchor-id="the-inputs">The Inputs</h2>
<section id="outfit-1-winter-sweater" class="level3">
<h3 class="anchored" data-anchor-id="outfit-1-winter-sweater">Outfit 1: Winter Sweater</h3>
<p><img src="sweater.png" class="img-fluid"></p>
</section>
<section id="outfit-2-cultural-clothing" class="level3">
<h3 class="anchored" data-anchor-id="outfit-2-cultural-clothing">Outfit 2: Cultural Clothing</h3>
<p><img src="cultural.png" class="img-fluid"></p>
</section>
<section id="outfit-3-greece-casual" class="level3">
<h3 class="anchored" data-anchor-id="outfit-3-greece-casual">Outfit 3: Greece Casual</h3>
<p><img src="greece.png" class="img-fluid"></p>
</section>
</section>
<section id="the-reviews-harsh-or-kind" class="level2">
<h2 class="anchored" data-anchor-id="the-reviews-harsh-or-kind">The Reviews (Harsh or Kind?)</h2>
<section id="vogue-fashion-editor" class="level3">
<h3 class="anchored" data-anchor-id="vogue-fashion-editor">1. Vogue Fashion Editor</h3>
<blockquote class="blockquote">
<p>Prompt for each outfit: â€œDescribe this outfit in the voice of a senior fashion editor at Vogue reviewing runway looks.â€</p>
</blockquote>
<section id="outfit-1-winter-sweater-1" class="level5">
<h5 class="anchored" data-anchor-id="outfit-1-winter-sweater-1">Outfit 1: Winter Sweater</h5>
<p>â€œCozy, yet deliberateâ€ This ensemble whispers understated chic. The oversized striped turtleneck sweater drapes with ease, pairing comfort with quiet sophistication. The soft palette of cool grays and blues is punctuated by a pop of pink from the handbagâ€”an editorial touch that prevents the look from sliding into anonymity. Itâ€™s winter dressing at its most approachable: functional warmth elevated with a fashion-forward wink.</p>
</section>
<section id="outfit-2-cultural-clothing-1" class="level5">
<h5 class="anchored" data-anchor-id="outfit-2-cultural-clothing-1">Outfit 2: Cultural Clothing</h5>
<p>â€œA triumph of heritage as haute coutureâ€ Here, tradition is transformed into spectacle. The fuchsia lehenga is unapologetically bold, its golden embroidery and zari work shimmering like threads of sunlight. The striped dupatta slung across the shoulder modernizes the silhouette, making it less museum piece, more runway force. Accessories are chosen with precision: a structured potli bag in tonal embroidery and gleaming bangles that echo the fabricâ€™s luster. This is cultural clothing not as costume, but as coutureâ€”alive, radiant, and utterly commanding.</p>
</section>
<section id="outfit-3-greece-casual-1" class="level5">
<h5 class="anchored" data-anchor-id="outfit-3-greece-casual-1">Outfit 3: Greece Casual</h5>
<p>â€œEffortless wanderlust in motionâ€ Against the raw stone frame and endless Aegean backdrop, the look feels cinematic. A red sleeveless top is paired with flowing white trousers, the palette a deliberate nod to Mediterranean contrasts. The crossbody bag adds artisanal charm, its geometric patchwork quietly bohemian. Hair loose, arms raised, the outfit breathes freedomâ€”an embodiment of travel chic where ease is the ultimate luxury.</p>
<section id="my-comments" class="level6">
<h6 class="anchored" data-anchor-id="my-comments">My comments</h6>
<p>I think that the LLM did well embodying the Vogue fashion editor persona. It was able to draw on a lot of external context when describing the outfits I sent it. Not only this, but it also was creative and unique in its description, making inferences about my intentions wearing the outfit rather than just turning image directly to text.</p>
</section>
</section>
</section>
<section id="tiktok-fashion-influencer" class="level3">
<h3 class="anchored" data-anchor-id="tiktok-fashion-influencer">2. TikTok Fashion Influencer</h3>
<blockquote class="blockquote">
<p>Prompt for each outfit: â€œRate this outfit like a TikTok fashion influencer doing a reaction video to someoneâ€™s instagram outfits. Be as kind as you want or roast them as much as you want.â€</p>
</blockquote>
<section id="outfit-1-winter-sweater-2" class="level5">
<h5 class="anchored" data-anchor-id="outfit-1-winter-sweater-2">Outfit 1: Winter Sweater</h5>
<p>Okayyy cozy vibes but also giving â€œI stole this from my dadâ€™s closetâ€ realness ğŸ˜‚ The stripes are safe, the turtleneck is warm, but itâ€™s giving less sleigh queen and more sleigh ride with grandma. That said, the pink bag is a cute popâ€”like yes, accessorizeeee! Honestly, 6.5/10: solidly cute, but could use a little more main character energy.</p>
</section>
<section id="outfit-2-cultural-clothing-2" class="level5">
<h5 class="anchored" data-anchor-id="outfit-2-cultural-clothing-2">Outfit 2: Cultural Clothing</h5>
<p>STOP. THE. SHOW. ğŸ”¥ğŸ”¥ğŸ”¥ This hot pink + gold embroidery + striped dupatta? Sheâ€™s not just attending the wedding, she IS the wedding. The matching embroidered purse?? Dead. This is giving regal Bollywood princess energy and Iâ€™m obsessed. If youâ€™re not breaking necks walking in, are you even doing it right? 11/10. No notes. Perfection. ğŸ‘‘âœ¨</p>
</section>
<section id="outfit-3-greece-casual-2" class="level5">
<h5 class="anchored" data-anchor-id="outfit-3-greece-casual-2">Outfit 3: Greece Casual</h5>
<p>This is such a vibeeee. Like picture this: stone ruins, ocean breeze, and she said â€œI am the goddess framed by history.â€ The red top + white skirt combo is casual but chefâ€™s kiss Mediterranean chic. That patterned crossbody bag is the artsy touchâ€”giving â€œI backpack through Europe and journal about my soul.â€ Honestly, this is effortless cool-girl travel fashion. 9/10.</p>
<section id="my-comments-1" class="level6">
<h6 class="anchored" data-anchor-id="my-comments-1">My comments</h6>
<p>I think that the LLM did a great job with the persona, but not as good of a job relating the image to the description. It picked up on one or two key characteristics of the outfit and focused more on talking/acting like a specific person rather than providing the review. An actual fashion influencer would not behave stereotypically as much.</p>
</section>
</section>
</section>
<section id="supportive-friend" class="level3">
<h3 class="anchored" data-anchor-id="supportive-friend">3. Supportive Friend</h3>
<blockquote class="blockquote">
<p>Prompt for each outfit: â€œDescribe, rate, and roast this outfit like my friend who supports me through anything, whoâ€™s known me forever, and will not lie to protect my feelings.â€</p>
</blockquote>
<section id="outfit-1-winter-sweater-3" class="level5">
<h5 class="anchored" data-anchor-id="outfit-1-winter-sweater-3">Outfit 1: Winter Sweater</h5>
<p>ğŸ“ Cozy vibes in front of the Christmas tree. Description: The oversized striped turtleneck screams â€œIâ€™m warm, Iâ€™m comfy, and fashion is optional today.â€ Itâ€™s giving college finals week chic. Paired with the little pink bag, though, you low-key look like youâ€™re on your way to brunch after acing those exams.</p>
<p>Rating: 7.5/10. Cute and cozy, but the sweater is kinda swallowing you whole.</p>
<p>Roast: Girlâ€¦ you look like you stole this sweater from a dad named Carl who fixes cars on the weekend. But somehow, you still managed to make â€œdad-coreâ€ look Instagrammable. Thatâ€™s talent.</p>
</section>
<section id="outfit-2-greece-casual" class="level5">
<h5 class="anchored" data-anchor-id="outfit-2-greece-casual">Outfit 2: Greece Casual</h5>
<p>ğŸ“ Arms in the air by the sea. Description: Red sleeveless top, flowy white skirt, and a bold patterned crossbody bag. Very â€œwanderlust study abroad catalog cover.â€</p>
<p>Rating: 8/10. Carefree and cute, but that bag is doing way too much.</p>
<p>Roast: You look like you were two seconds away from shouting â€œOPA!â€ and tripping into the water. The outfit is vacation-perfect, but the bag? Itâ€™s giving â€œI bought this from the gift shop so I could blend in with locals,â€ but instead you stood out like the tourist you are.</p>
</section>
<section id="outfit-3-cultural-clothing" class="level5">
<h5 class="anchored" data-anchor-id="outfit-3-cultural-clothing">Outfit 3: Cultural Clothing</h5>
<p>ğŸ“ Bright pink lehenga with gold embroidery. Description: Absolutely stunning. The embroidery, the dupatta drape, the matching round bag â€” itâ€™s all working. This is main character energy.</p>
<p>Rating: 11/10. No notes.</p>
<p>Roast: Honestly, roasting this feels illegal. The only critique I have is that youâ€™re out here making everyone else at the event look like they got their outfit off Amazon for $39.99. Itâ€™s unfair.</p>
<section id="my-comments-2" class="level6">
<h6 class="anchored" data-anchor-id="my-comments-2">My comments</h6>
<p>Again, similar to the TikTok fashion influencer persona, the LLM seems to focus more on the character rather than the description. I think that a more human-like response would include a more normal opinion on the outfits with one or two words or maybe even just a slight tone that would indicate a persona.</p>
</section>
</section>
</section>
</section>
<section id="final-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="final-takeaways">Final Takeaways</h2>
<p>SO, can GPT â€œseeâ€ fashion from a description?</p>
<p>Seems like it!</p>
<p>The LLM was able to describe the outfit well and used image traits to convey specific opinions. By taking on different personas, ChatGPT clearly formed unique thoughts about the outfits even though the look was the same. This makes me believe that the LLM may actually be thinking rather than just copy pasting pixel descriptions from the model it is trained on.</p>
<p>Maybe next I could prompt it to build outfits based on a pre-existing fashion senseâ€¦</p>
<p>Stay fashionably self-aware,</p>
<p>Mallika</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mallikakulkarni20\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>